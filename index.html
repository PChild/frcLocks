<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="FRC District Championship Locks">
  <meta name="author" content="pchild">

  <title>FRC District Championship Locks</title>

  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="manifest" href="images/site.webmanifest">
  <link rel="mask-icon" href="images/safari-pinned-tab.svg" color="#ffffff">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.13.5/dist/bootstrap-table.min.css">
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.13.5/dist/extensions/sticky-header/bootstrap-table-sticky-header.css" rel="stylesheet">
  <style>
    body {
      padding-top: 2rem;
    }
    
    .general {
      padding: 2rem;
      text-align: center;
    }
    
    table a {
      color: darkblue;
    }
    
    .navbar-nav li a {
      border: 1px solid grey;
      border-radius: 5px;
      margin: 1px 2px 1px 2px;
      padding: 5px;
      font-size: small;
    }
    
    .nav-link.active {
      border-color: white;
    }
    
    @media (max-width: 767.98px) {
      .container {
        padding: 0;
        margin: 0;
      }
      .general {
        padding: 1rem 5px;
      }
    }

    @media (max-width: 991px) {
      .navbar-nav li a {
        font-size: large;
      }
    }

    @media (min-width: 1230px) {
      .navbar-nav li a {
        font-size: medium;
      }
    }

    ::-webkit-scrollbar {
      width: 5px;
    }

    ::-webkit-scrollbar-track {
      box-shadow: inset 0 0 5px grey;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: #343a40;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="padding: 5px 0 5px 5px; margin: 0px">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menuContainer" style="margin-right: 10px;">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand mr-auto" href="#" style="padding: 0; margin: 0 5px 0 0;">FRC Locks</a>
    <div class="collapse navbar-collapse" id="menuContainer">
      <ul class="navbar-nav d-flex mx-auto flex-fill align-items-stretch">
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#about" id="about">About</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#chs" id="chs">Chesapeake</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#in" id="in">Indiana</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#isr" id="isr">Israel</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#fim" id="fim">Michigan</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#fma" id="fma">Mid-Atlantic</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#ne" id="ne">New England</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#fnc" id="fnc">North Carolina</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#ont" id="ont">Ontario</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#pch" id="pch">Peachtree</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#pnw" id="pnw">Pacific Northwest</a>
        </li>
        <li class="nav-item flex-fill text-center">
          <a class="nav-link" href="#tx" id="tx">Texas</a>
        </li>
      </ul>
    </div>
  </nav>

  <main role="main" class="container">

    <div class="general" id="distView">
      <h1 id="distName"></h1>
      <table id="statisticsTable"></table>
      <br>
      <table id="eventsTable"></table>
      <br>
      <table id="ranksTable" data-row-style="rowStyler"></table>
    </div>

    <div class="general" id="aboutView">
      <p style="text-align: left">The purpose of FRC Locks, for those new to districts or new to FIRST, is to calculate who is mathematically locked into their district championship ahead of district play ending. Its something to follow and keep an eye on as the competition weeks wind down to see where your team sits. You can see it in action <a href="https://youtu.be/rZHWbRdVGfQ?t=583"><u>here</u></a> thanks to Shawn Lim featuring it on his Ask the Experts webinar a few years back.
        <br>
        <br> Teams shown in Yellow are still in the hunt for a spot at district champs. Teams shown in Green have clinched their way in on points. Teams shown in blue have won a chairman’s award which guarantees them a spot at district champs. Teams shown in red have been eliminated.
        <br>
        <br> FRC Locks will update “live” every 10 minutes during events! You can track how many points your team has earned and where they sit in the rankings and your lock status live as you compete. The event table near the top will update with the event status such as “Qualifications”, “Alliance Selections”, “Semi-Finals”, ect.</p>
      <h4>
        Written by <a href="https://www.chiefdelphi.com/u/brandon_l/">Brandon Liatys</a> / <a href="https://www.thebluealliance.com/team/2108">FRC 2180</a>
        <br>
        Based on algorithm by <a href="https://www.chiefdelphi.com/u/agpapa/">Antonio Papa</a> / <a href="https://www.thebluealliance.com/team/3324">FRC 3324</a>
        <br>
        Frontend by <a href="https://www.chiefdelphi.com/u/pchild/">Preston Childress</a> / <a href="https://www.thebluealliance.com/team/401">FRC 401</a>
      </h4>
    </div>

  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-table@1.13.5/dist/bootstrap-table.min.js"></script>
  <script src="https://unpkg.com/bootstrap-table@1.13.5/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>

  <script>
    let eventStatusMap = {
      0: "Pre-Event",
      1: "Qualifications",
      2: "Selections",
      3: "Quarterfinals",
      4: "Semifinals",
      5: "Finals",
      6: "Awards",
      7: "Complete"
    }

    let distNamesMap = {
      'chs': '<i>FIRST</i> Chesapeake District',
      'fim': '<i>FIRST</i> in Michigan District',
      'fma': '<i>FIRST</i> Mid-Atlantic District',
      'in': 'Indiana <i>FIRST</i> District',
      'isr': '<i>FIRST</i> Israel District',
      'ne': 'New England District',
      'fnc': '<i>FIRST</i> North Carolina District',
      'ont': 'Ontario District',
      'pch': 'Peachtree District',
      'pnw': 'Pacific Northwest District',
      'tx': '<i>FIRST</i> in Texas District'

    }

    let statisticsData = [];
    let eventsData = [];
    let ranksData = [];

    function blankData() {
      statisticsData = [];
      eventsData = [];
      ranksData = [];

      $('#statisticsTable').bootstrapTable("load", statisticsData);
      $('#eventsTable').bootstrapTable("load", eventsData);
      $('#ranksTable').bootstrapTable("load", ranksData);

    }

    function updateDistrict(dist) {
      let dataURL = "https://frclocks.com/raw.php?d=";

      if (window.location.hostname != "frclocks.com") {
        dataURL = "https://cors-anywhere.herokuapp.com/" + dataURL;
      }

      $.getJSON(dataURL + dist, function (result) {

        //Organize district statistics data and load into table
        statisticsData = [{
          label: 'District Points Remaining',
          value: result.points_remaining,
          color: "FFD966"
        }, {
          label: 'District Champs Slots',
          value: result.dcmp_slots,
          color: "FFD966"
        }]
        $('#statisticsTable').bootstrapTable("load", statisticsData);

        //Events table data and loading
        $.each(result["events"], function (idx, item) {
          eventsData.push({
            name: '<u><a href="http://thebluealliance.com/event/' + item.key + '">' + item.name + '</a></u>',
            status: eventStatusMap[item.progress],
            teamCount: item.teams.length,
            ptsLeft: item.points_remaining.total,
            color: item.color
          })
        })
        $('#eventsTable').bootstrapTable("load", eventsData);

        //Ranks data and loading to table
        $.each(result["rankings"], function (idx, item) {
          ranksData.push({
            rank: item.rank,
            teamNum: item.team_number,
            team: '<u><a href="http://www.thebluealliance.com/team/' + item.team_number + '">' + item.team_number + '</a></u>',
            event1: item.event_points[0].total,
            event2: item.event_points[1].total,
            ageBonus: item.rookie_bonus,
            total: item.point_total,
            lockPercent: item.lock_percent,
            color: item.color
          })
        })
        $('#ranksTable').bootstrapTable("load", ranksData);

      });
    }

    $('#eventsTable').bootstrapTable({
      columns: [{
        field: 'name',
        title: 'Event'
      }, {
        field: 'status',
        title: 'Status'
      }, {
        field: 'teamCount',
        title: '# Teams'
      }, {
        field: 'ptsLeft',
        title: 'Pts Avail'
      }, ],
      data: eventsData,
      formatNoMatches: noMatches,
      rowStyle: rowStyler,
      theadClasses: 'thead-dark',
      classes: 'table table-bordered table-sm'
    })

    $('#statisticsTable').bootstrapTable({
      columns: [{
        field: 'label',
        title: 'Statistic'
      }, {
        field: 'value',
        title: 'Value'
      }, ],
      data: statisticsData,
      formatNoMatches: noMatches,
      rowStyle: rowStyler,
      theadClasses: 'thead-dark',
      classes: 'table table-bordered table-sm'
    })

    $('#ranksTable').bootstrapTable({
      columns: [{
        field: 'rank',
        title: 'Rank',
        sortable: true
      }, {
        field: 'team',
        title: 'Team',
        sortable: true,
        sortName: 'teamNum'
      }, {
        field: 'event1',
        title: 'Event 1',
        sortable: true
      }, {
        field: 'event2',
        title: 'Event 2',
        sortable: true
      }, {
        field: 'ageBonus',
        title: 'Age Bonus',
        sortable: true
      }, {
        field: 'total',
        title: 'Total',
        sortable: true
      }, {
        field: 'lockPercent',
        title: 'Lock %',
        sortable: true
      }, ],
      data: ranksData,
      formatNoMatches: noMatches,
      rowStyle: rowStyler,
      theadClasses: 'thead-dark',
      classes: 'table table-bordered table-sm',
      stickyHeader: true,
      stickyHeaderOffsetY: 40
    });

    function noMatches() {
      return 'Loading data...';
    }

    function rowStyler(row, index) {
      return {
        css: {
          background: "#" + row.color,
          border: "1px solid black"
        }
      }
    }

    function handleInvalid() {
      history.pushState(null, null, "#about");
      $(window.location.hash).addClass('active');
      $('#distView').hide();
    }

    function pageHandlder() {
      $('li').removeClass('active');
      $('a').removeClass('active');
      $(window.location.hash).addClass('active');

      let isValid = false;
      let isAbout = false;
      let hashText = "";
      let hashArray = window.location.hash.split('#');

      if (hashArray.length > 1) {
        hashText = hashArray[1];
        isAbout = hashText == 'about';

        let isDist = Object.keys(distNamesMap).includes(hashText);

        isValid = isAbout || isDist;
      }

      if (isValid) {
        if (isAbout) {
          $('#aboutView').show();
          $('#distView').hide();
        } else {
          $('#aboutView').hide();
          $('#distView').show();
          $('#distName')[0].innerHTML = distNamesMap[hashText];
          blankData();
          updateDistrict(hashText);
        }
      } else {
        handleInvalid();
      }

    }

    function mobileHandler() {
      if ($(window).width() < 992) {
        $('#ranksTable').bootstrapTable("hideColumn", "event1");
        $('#ranksTable').bootstrapTable("hideColumn", "event2");
        $('#ranksTable').bootstrapTable("hideColumn", "ageBonus");
      } else {
        $('#ranksTable').bootstrapTable("showColumn", "event1");
        $('#ranksTable').bootstrapTable("showColumn", "event2");
        $('#ranksTable').bootstrapTable("showColumn", "ageBonus");
      }
    }

    //Register page handler listeners
    $(document).ready(pageHandlder);
    $(window).on('hashchange', pageHandlder);

    //Register resize handler
    $(document).ready(mobileHandler);
    $(window).resize(mobileHandler);

    //Make the menu auto close on click on mobile
    $('.navbar-nav>li>a').on('click', function () {
      $('.navbar-collapse').collapse('hide');
    });
  </script>
</body>

</html>
